{"version":3,"sources":["../../../src/routes/api/entries.js"],"names":["router","get","req","res","entries","Entry","find","sort","createdAt","populate","json","map","ent","toJSON","err","status","message","entry","findById","params","id","post","requireJwtAuth","error","body","details","Message","create","date","breakfast","lunch","dinner","snacks","groceries","user","execPopulate","delete","tempEntry","role","findByIdAndRemove","put","findByIdAndUpdate","new"],"mappings":"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","sourcesContent":["import { Router } from 'express';\nimport requireJwtAuth from '../../middleware/requireJwtAuth';\nimport Entry, { validateEntry } from '../../models/Entry';\n\nconst router = Router();\n\nrouter.get('/', async (req, res) => {\n  try {\n    const entries = await Entry.find().sort({ createdAt: 'desc' }).populate('user');\n\n    res.json({\n      entries: entries.map((ent) => {\n        return ent.toJSON();\n      }),\n    });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.get('/:id', async (req, res) => {\n  try {\n    const entry = await Entry.findById(req.params.id).populate('user');\n    if (!entry) return res.status(404).json({ message: 'No entry found.' });\n    res.json({ entry: entry.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.post('/', requireJwtAuth, async (req, res) => {\n  const { error } = validateEntry(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    let entry = await Message.create({\n      date: req.body.date,\n      breakfast: req.body.breakfast,\n      lunch: req.body.lunch,\n      dinner: req.body.dinner,\n      snacks: req.body.snacks,\n      groceries: req.body.groceries,\n      user: req.user.id,\n    });\n    entry = await entry.populate('user').execPopulate();\n\n    res.status(200).json({ entry: entry.toJSON() });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.delete('/:id', requireJwtAuth, async (req, res) => {\n  try {\n    const tempEntry = await Entry.findById(req.params.id).populate('user');\n    if (!(tempEntry.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the message owner or admin.' });\n\n    const entry = await Entry.findByIdAndRemove(req.params.id).populate('user');\n    if (!entry) return res.status(404).json({ message: 'No entry found.' });\n    res.status(200).json({ entry });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nrouter.put('/:id', requireJwtAuth, async (req, res) => {\n  const { error } = validateEntry(req.body);\n  if (error) return res.status(400).json({ message: error.details[0].message });\n\n  try {\n    const tempEntry = await Entry.findById(req.params.id).populate('user');\n    if (!(tempEntry.user.id === req.user.id || req.user.role === 'ADMIN'))\n      return res.status(400).json({ message: 'Not the entry owner or admin.' });\n\n    let entry = await Entry.findByIdAndUpdate(\n      req.params.id,\n      {\n        date: req.body.date,\n        breakfast: req.body.breakfast,\n        lunch: req.body.lunch,\n        dinner: req.body.dinner,\n        snacks: req.body.snacks,\n        groceries: req.body.groceries,\n        user: req.user.id,\n      },\n      { new: true },\n    );\n    if (!entry) return res.status(404).json({ message: 'No entry found.' });\n    entry = await entry.populate('user').execPopulate();\n\n    res.status(200).json({ entry });\n  } catch (err) {\n    res.status(500).json({ message: 'Something went wrong.' });\n  }\n});\n\nexport default router;\n"],"file":"entries.js"}